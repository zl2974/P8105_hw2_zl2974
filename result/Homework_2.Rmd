---
title: "Homework 2"
author: "Jeffrey Liang"
date: "9/23/2020"
output: github_document
---
```{r setup ,echo = F, message= F}
library(tidyverse)
```

# Problem 1 

## Load Wheel data
```{r load_whell_data, warning=F, message=FALSE}
data_collection = c()
for (i in c(1:3)){
  data_collection[[i]] = 
    readxl::read_excel(
      paste(here::here(),"/data/Trash-Wheel-Collection-Totals-8-6-19.xlsx",sep=''),
      skip = 1, 
      sheet = i
    ) %>% 
    janitor::clean_names() %>% 
    select( -starts_with('X1'))
}

wheel_df = bind_rows(data_collection)

preci_collection = c()
for (i in c(4:9)){
  preci_collection[[i]] = 
    readxl::read_excel(
      paste(here::here(),"/data/Trash-Wheel-Collection-Totals-8-6-19.xlsx",sep=''),
      skip = 1,
      sheet = i
    ) %>% 
    janitor::clean_names() %>% 
    mutate(year = 2020 + 3 -i)
}

preci_df = bind_rows(preci_collection)

rm(data_collection,preci_collection)
```


## Clean Wheel data

```{r clean_data}
wheel_df = #clean wheel
  wheel_df %>% 
  filter(
    #!grep(" Total",get('month')), #this command return vector with null row, so the data can't subset
    !str_detect(get("month")," Total"),
    !is.na(get("dumpster"))
    ) %>% 
  mutate(sports_balls = 
           as.integer(round(get("sports_balls")))
         )
tail(wheel_df)
```

## Clean precipitation data
```{r}
preci_df = 
  preci_df %>%
  filter(!is.na(get("month")),
         get('year') %in% c(2018,2017)
         ) %>% 
  mutate(month =
           apply( # this is the apply() function in R, need to specific dim before giving function, weird
             as.matrix(           # as.matrix is very important here, cuz pull() or get() have NULL dim()
             get("month")
             ), 1, # specific dim()
             function(x) month.name[[x]]) # this is how to write lambda in R, clean
  )
tail(preci_df)
```


## Write something about this data
 
\newpage
# Problem 2

## load data
```{r load_nyc,message=F,warning=F}
read_nyc = function(){
return_data = read_csv(
  paste(here::here(),"/data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv",sep = '')
) %>% 
  janitor::clean_names()
return(return_data)
}
#skimr::skim_without_charts(nyc_df) # TODO: route* need to be in the same columns
```

## Clean data
```{r how_to_do_for_loop_mutation, include=FALSE,echo = FALSE}
nyc_df = read_nyc()
for (i in 1:11){
  col_name = paste("route",i,sep='')
  mutate(nyc_df,!!as.symbol(col_name) := as.character(pull(nyc_df,as.name(col_name))))
  #use !! before variable to avoid evaluation, use := for dynamic name assigning
  # I have to say, dplyr is readable, but pain in the ass from a computing perspective,
  # one thing for sure that it would be great amount of work transferring dplyr script to other language
}
```

```{r clean_nyc_data,warning=F,message=F}
nyc_df = 
  read_nyc() %>% 
  pivot_longer( #make unique names
    cols = c(line,station_name),
    names_to ='station_id_type',
    values_to = "station_id",
    names_prefix = "station_"
  ) %>% 
  relocate(station_id_type,station_id) %>% 
  separate( #clean staff hour, just experiment
    col = staff_hours,
    into = c("staff_hours_start",'staff_hours_end','staff_hours_shift'),
    sep = "[- ]"
  ) %>% 
  mutate(across(matches('route'),as.character)) %>% #OR use across(matches("something",fun))
  relocate(route1:route11,.after = last_col()) %>% 
  pivot_longer( # clean route* variables to meaningful route variable
    cols = route1:route11, #route 8 is numeric
    names_to = "route_served",
    values_to = 'route_value',
    names_prefix = 'route'
  ) %>% 
  mutate(entry = if_else(apply(as.matrix(entry),1,str_to_lower)=="yes",TRUE,FALSE,NA)) %>% 
  select(station_id_type:station_longitude,route_served,entry,vending,entrance_type,ada)
skimr::skim_without_charts(nyc_df)
```
This NYC's metro system data is a `r nrow(read_nyc())` $\times$ `r ncol(read_nyc())` size data, describing NYC metro system's `r paste(names(read_nyc()),sep = ',')`

Write a short paragraph about this dataset â€“ explain briefly what variables the dataset contains, describe your data cleaning steps so far, and give the dimension (rows x columns) of the resulting dataset. Are these data tidy?

Answer the following questions using these data:

How many distinct stations are there? Note that stations are identified both by name and by line (e.g. 125th St A/B/C/D; 125st 1; 125st 4/5); the distinct function may be useful here.
How many stations are ADA compliant?
What proportion of station entrances / exits without vending allow entrance?



